<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>ISS Historical Data</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<style>
  body { font-family: Arial, sans-serif; margin: 20px; }
  table { width: 100%; border-collapse: collapse; margin-top: 20px; }
  th, td { border: 1px solid #ccc; padding: 8px; text-align: center; }
  th { background-color: #eee; }
  select { padding: 5px; margin-right: 10px; }
  button { padding: 5px 10px; }
</style>
</head>
<body>

<h1>ISS Historical Data Viewer</h1>

<label for="daySelect">Filter by day:</label>
<select id="daySelect">
  <option value="">All Days</option>
</select>
<button onclick="loadData()">Load Data</button>

<table id="dataTable">
  <thead>
    <tr>
      <th>ID</th>
      <th>Timestamp (UTC)</th>
      <th>Latitude</th>
      <th>Longitude</th>
      <th>Altitude (km)</th>
    </tr>
  </thead>
  <tbody></tbody>
</table>

<script>
let currentPage = 1;
let totalPages = 1;

function loadDays() {
    fetch('/api/all-records')
        .then(res => res.json())
        .then(data => {
            const daySelect = document.getElementById('daySelect');
            daySelect.innerHTML = '<option value="">All Days</option>';
            data.available_days.forEach(d => {
                const opt = document.createElement('option');
                opt.value = d;
                opt.text = d;
                daySelect.add(opt);
            });
        });
}

function loadData(page=1) {
    const day = document.getElementById('daySelect').value;
    fetch(`/api/all-records?page=${page}&per_page=100&day=${day}`)
        .then(res => res.json())
        .then(data => {
            const tbody = document.querySelector('#dataTable tbody');
            tbody.innerHTML = '';
            data.records.forEach(r => {
                const tr = document.createElement('tr');
                tr.innerHTML = `<td>${r.id}</td><td>${r.ts_utc}</td><td>${r.latitude.toFixed(2)}</td><td>${r.longitude.toFixed(2)}</td><td>${r.altitude.toFixed(2)}</td>`;
                tbody.appendChild(tr);
            });
            currentPage = data.page;
            totalPages = data.total_pages;
        });
}

// Auto-refresh every 30 sec
setInterval(() => loadData(currentPage), 30000);

loadDays();
loadData();
</script>
</body>
</html>
